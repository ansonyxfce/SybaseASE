CREATE DATABASE BANCAONLINE ON DEFAULT = 7

go

USE BANCAONLINE

go

CREATE TABLE IMG_SEGURIDAD
( cod_imagen VARCHAR(8) NOT NULL,
imagen IMAGE NOT NULL,
PRIMARY KEY(cod_imagen))

go

CREATE TABLE CLIENTE
(CI VARCHAR(10) NOT NULL,
nombre VARCHAR(40) NOT NULL,
apellido VARCHAR(40) NOT NULL,
tlf VARCHAR(15) NULL,
correo VARCHAR(50) NULL,
PRIMARY KEY (CI))

go

CREATE TABLE USUARIO
( CI VARCHAR(10),
nick VARCHAR(15) NOT NULL,
pass VARCHAR(8) NOT NULL,
correo VARCHAR(50) NOT NULL,
p1 VARCHAR(200) NOT NULL,
r1 VARCHAR(50) NOT NULL,
clave_especial VARCHAR(4) NOT NULL,
cod_imagen VARCHAR(8) NOT NULL,
estado VARCHAR(20) NULL,
n_error int NULL,
PRIMARY KEY(CI, nick),
UNIQUE(nick),
FOREIGN KEY (CI) REFERENCES CLIENTE(CI),
FOREIGN KEY (cod_imagen) REFERENCES IMG_SEGURIDAD(cod_imagen))              

go

CREATE TABLE CUENTA
( CI VARCHAR(10),
n_cuenta VARCHAR(50) NOT NULL,
tipo_cuenta VARCHAR(30) NOT NULL, 
PRIMARY KEY (CI, n_cuenta, tipo_cuenta),
UNIQUE(n_cuenta),
FOREIGN KEY(CI) REFERENCES CLIENTE(CI))

go

CREATE TABLE TARJETAS
( CI VARCHAR(10),
n_tarj VARCHAR(50) NOT NULL,
tipo_tarj VARCHAR(30) NOT NULL,
nom_titular VARCHAR(40) NOT NULL,
limite NUMERIC NULL,
f_inicio DATE NOT NULL,
f_vencimiento DATE NOT NULL,
pago_total NUMERIC NULL,
n_cta_asoc VARCHAR(50) NULL,
descrip VARCHAR(100) NULL,
PRIMARY KEY (CI, n_tarj),
FOREIGN KEY(CI) REFERENCES CLIENTE(CI),
UNIQUE(n_tarj))

go

CREATE TABLE TRANS_CUENTAS
( n_cta VARCHAR(50) NOT NULL,
referencia INT NOT NULL,
descrip VARCHAR(100) NOT NULL,
monto NUMERIC NOT NULL,
saldo_fin NUMERIC NOT NULL,
fecha date NOT NULL,
PRIMARY KEY (n_cta, referencia),
FOREIGN KEY(n_cta) REFERENCES CUENTA(n_cuenta))

go

CREATE TABLE TRANS_TARJETAS
(n_tarj VARCHAR(50) NOT NULL,
referencia INT NOT NULL,
descrip VARCHAR(100) NOT NULL,
monto NUMERIC NOT NULL,
fecha DATE NOT NULL,
PRIMARY KEY (n_tarj, referencia),
FOREIGN KEY(n_tarj) REFERENCES TARJETAS(n_tarj))

go 

CREATE TABLE TRANSFERENCIAS
(fecha DATE NOT NULL,
referencia INT NOT NULL,
CI VARCHAR(10),
n_cta_propia VARCHAR(50) NOT NULL,
CI_tercero VARCHAR(10) NOT NULL,
nombre_terc VARCHAR(50) NOT NULL,
n_cta_terc VARCHAR(50) NOT NULL,
monto NUMERIC NOT NULL,
comentario VARCHAR(200) NULL,
tipo_banco VARCHAR(15) NOT NULL,
PRIMARY KEY (CI,referencia),
FOREIGN KEY (CI) REFERENCES CLIENTE(CI),
FOREIGN KEY (n_cta_propia) REFERENCES CUENTA(n_cuenta))

go

CREATE TABLE RESPALDO_CLAVES
(
    fecha_mod DATE NULL,
    nick VARCHAR(15) NOT NULL,
    pass_viejo VARCHAR(8) NOT NULL,
    pass_nuevo VARCHAR(8) NOT NULL,
PRIMARY KEY(nick,pass_viejo,pass_nuevo)
)

go


CREATE TABLE RESPALDO_TARJETAS
(num NUMERIC(12,0) IDENTITY,
fecha_mod DATE NOT NULL,
CI VARCHAR(10) NOT NULL,
n_tarj VARCHAR(50) NOT NULL,
monto_viejo NUMERIC NULL,
monto_nuevo NUMERIC NULL,
PRIMARY KEY (num)
)

go

CREATE TABLE RESPALDO_TRANS_TARJETAS
(num NUMERIC(12,0) IDENTITY,
n_tarj VARCHAR(50) NOT NULL,
referencia INT NOT NULL,
descrip VARCHAR(100) NOT NULL,
monto NUMERIC NOT NULL,
fecha DATE NOT NULL,
PRIMARY KEY(num)
)

go

CREATE TABLE RES_TRANS_CUENTAS
(num NUMERIC(12,0) IDENTITY,
n_cta VARCHAR(50) NOT NULL,
referencia INT NOT NULL,
descrip VARCHAR(100) NOT NULL,
monto NUMERIC NOT NULL,
saldo_fin NUMERIC NOT NULL,
fecha date NOT NULL,
PRIMARY KEY (num))

go

CREATE TABLE RESPALDO_USUARIO
( num NUMERIC(12,0) IDENTITY,
  fecha DATE NOT NULL,
  CI VARCHAR(10) NOT NULL,
  nick VARCHAR(15) NOT NULL,
  pass VARCHAR(8) NOT NULL,
PRIMARY KEY (num)
)
